<!DOCTYPE html><html lang="ja"><head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="../style.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <title>関数</title>
    </head>
    <body><h1 id="関数">関数</h1>
<p>Pythonは関数を柔軟に定義できるだけでなく、多くの便利な関数が組み込まれています。</p>
<h2 id="関数の定義と呼び出し">関数の定義と呼び出し</h2>
<p>Pythonの関数を定義するには、def文を使用し、関数名、括弧、括弧内のパラメーター、およびコロンを順に記述し、次にインデントされたブロックに関数本体を記述します。関数の戻り値はreturn文で返されます。returnがない場合に関数は実行後にNoneを返します。
Pythonの関数の構文は次のようになります。</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">function</span>(<span class="hljs-params"> parameters </span>):</span>
   statements
   <span class="hljs-keyword">return</span> [expression]</code></pre>
<p>関数は複数の値を返すことができます。関数を呼び出すには、関数の名前とパラメータを知っている必要があります。</p>
<p>例：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun</span>():</span>
    x1 = <span class="hljs-number">2</span>
    y1 = <span class="hljs-number">0</span>
    <span class="hljs-keyword">return</span> x1, y1

x,y = fun()    <span class="hljs-comment">#fun()を呼び出します。</span>
z = fun()
print(x, y)
print(z)</code></pre>
<p>Output:</p>
<pre><code class="python">2 0
(2, 0)</code></pre>
<p>複数の値を返す場合は実際には一つのタプルが返されます。複数の変数が一つのタプルを同時に受け取り、位置に応じて対応する値が割り当てられます。</p>
<h2 id="関数のパラメータ">関数のパラメータ</h2>
<h3 id="位置パラメータ">位置パラメータ</h3>
<p>べき乗を求める関数を定義します。</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">power</span>(<span class="hljs-params">x, n</span>):</span>
    s = <span class="hljs-number">1</span>
    <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:
        n = n - <span class="hljs-number">1</span>
        s = s * x
    <span class="hljs-keyword">return</span> s</code></pre>
<p>xとnは位置パラメータです。関数を呼び出すと、渡された2つの値が位置に従ってパラメータxとnに順に割り当てられます。そうしないとエラーが発生します。</p>
<h3 id="デフォルトのパラメータ">デフォルトのパラメータ</h3>
<p>関数を宣言するときに、パラメーターをデフォルト値に設定できます。関数を呼び出すときにその値を割り当てる必要はありません。</p>
<p>例：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">power</span>(<span class="hljs-params">x, n=<span class="hljs-number">2</span></span>):</span>
    s = <span class="hljs-number">1</span>
    <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:
        n = n - <span class="hljs-number">1</span>
        s = s * x
    <span class="hljs-keyword">return</span> s
print(power(<span class="hljs-number">5</span>))</code></pre>
<p>Output:<code>25</code></p>
<p>デフォルトパラメータはデフォルトのパラメータは後ろに配置する必要があります。前に配置すると、コンパイラは混乱します：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit</span>(<span class="hljs-params">name, amount=<span class="hljs-number">6</span>, color, price=<span class="hljs-number">20</span></span>):</span>
    print(<span class="hljs-string">'name:'</span>, name)
    print(<span class="hljs-string">'amount:'</span>, amount)
    print(<span class="hljs-string">'color:'</span>, color)
    print(<span class="hljs-string">'price:'</span>, price)
fruit(<span class="hljs-string">'banana'</span>, <span class="hljs-string">'yellow'</span>)</code></pre>
<p>Output:</p>
<pre><code class="python">  File ..., line <span class="hljs-number">1</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit</span>(<span class="hljs-params">name, amount=<span class="hljs-number">6</span>, color , price=<span class="hljs-number">20</span></span>):</span>
             ^
SyntaxError: non-default argument follows default argument</code></pre>
<p>複数のデフォルトパラメータがある場合は、キーワードを使用して、割り当てるパラメータを指定することができます:</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit</span>(<span class="hljs-params">name, color, amount=<span class="hljs-number">6</span>, price=<span class="hljs-number">20</span></span>):</span>
    print(<span class="hljs-string">'name:'</span>, name)
    print(<span class="hljs-string">'amount:'</span>, amount)
    print(<span class="hljs-string">'color:'</span>, color)
    print(<span class="hljs-string">'price:'</span>, price)
fruit2(<span class="hljs-string">'banana'</span>, <span class="hljs-string">'yellow'</span>,　price=<span class="hljs-number">50</span>)       <span class="hljs-comment">#priceの値を指定します。</span></code></pre>
<p>デフォルトのパラメータは不変オブジェクトを指す必要があります。リストを使用する場合：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">appendstr</span>(<span class="hljs-params">deflist=[]</span>):</span>
    deflist.append(<span class="hljs-string">'Default'</span>)
    <span class="hljs-keyword">return</span> deflist
print(appendstr())
print(appendstr())</code></pre>
<p>Output:</p>
<pre><code class="python">[<span class="hljs-string">'Default'</span>]
[<span class="hljs-string">'Default'</span>, <span class="hljs-string">'Default'</span>]</code></pre>
<p>再宣言のdeflistの値はリセットされていません。内部デフォルト変数の値が記憶され、Default値を累積しました。</p>
<h3 id="可変長パラメータ">可変長パラメータ</h3>
<p>宣言したときより多くのパラメータを処理できる関数が必要になる場合があります。その場合は宣言するときにパラメーターの前に<code>*</code>を付けます。</p>
<p>例：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sumup</span>(<span class="hljs-params">*numbers</span>):</span>
    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> numbers:
        <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + n
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>
print(sumup(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>))</code></pre>
<p>Output:<code>15</code></p>
<p>関数内では、受け取ったパラメーター<code>numbers</code>はタプルです。タプル型パラメータを可変長パラメータに代入する場合も<code>*</code>を使います。</p>
<pre><code class="python">nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
print(sumup(*nums))</code></pre>
<h3 id="キーワードパラメータ">キーワードパラメータ</h3>
<p>キーワードパラメータを使用すると、0または任意の数のパラメータをパラメータ名（必要）で渡すことができます。これらのキーワードパラメータは、関数内にdictで自動的に変換されます。宣言するときにパラメーターの前に<code>**</code>を付けます。</p>
<p>例：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit</span>(<span class="hljs-params">name, color, **kw</span>):</span>
    print(<span class="hljs-string">'name:'</span>, name, <span class="hljs-string">'color:'</span>, color, <span class="hljs-string">'info:'</span>, kw)
fruit(<span class="hljs-string">'apple'</span>,<span class="hljs-string">'red'</span>, shape=<span class="hljs-string">'round'</span>,price=<span class="hljs-number">70</span>)</code></pre>
<p>Output:</p>
<pre><code class="python">name: apple color: red info: {<span class="hljs-string">'shape'</span>: <span class="hljs-string">'round'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-number">70</span>}</code></pre>
<p>キーワードパラメータの名前を制限する場合は、名前付きキーワードパラメータを使用できます。</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fruit4</span>(<span class="hljs-params">name, color, *, shape, price</span>):</span>
    print(<span class="hljs-string">'name:'</span>, name, <span class="hljs-string">'color:'</span>, color, <span class="hljs-string">'shape:'</span>, shape,<span class="hljs-string">'price:'</span>, price)</code></pre>
<h2 id="lambda">lambda</h2>
<p>ラムダはdefより簡単な形式の関数（式）です。
ラムダ関数の構文にはステートメントが1つだけ含まれています。次のようになります。</p>
<pre><code class="python"><span class="hljs-keyword">lambda</span> [arg1 (arg2, arg3, ...)]:expression</code></pre>
<p>例：</p>
<pre><code class="python">g = <span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">3</span>
print(g(<span class="hljs-number">4</span>))</code></pre>
<p>Output:<code>1</code></p>
<p>シーケンスオブジェクトを操作する場合には、<code>map()</code>関数を使用してオブジェクトをイテレータにマップできます。</p>
<pre><code class="python">nums = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]
nums2 = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>]
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x,y: x+y, nums,nums2)):
    print(i,end=<span class="hljs-string">' '</span>)</code></pre>
<p>Output:<code>3 7 11 </code></p>
<p>これはジェネレータとfor文を直接使用するのと同じです。</p>
<pre><code class="python">[x+y for x in nums for y in nums2]</code></pre>
<h2 id="関数の使用">関数の使用</h2>
<p>1つの関数が別の関数をパラメータとして受け取ることができます。 この関数は高次関数と呼ばれます。</p>
<p>例：</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">x,y,f</span>):</span>
    <span class="hljs-keyword">return</span> f(x)+y
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun</span>(<span class="hljs-params">a</span>):</span>
    <span class="hljs-keyword">return</span> a**<span class="hljs-number">2</span>
print(add(<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,fun))</code></pre>
<p>Output:<code>7</code></p>
<p>add関数を呼び出し、add関数にfun関数をパラメータとして代入します。</p>
<h3 id="デコレータ">デコレータ</h3>
<p>関数の本体を変更せずに関数の機能を増やしたい場合があります。デコレータは関数を返す高次関数です。 次のように例を挙げます。</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span>(<span class="hljs-params">fun</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prt</span>(<span class="hljs-params">*args, **kw</span>):</span>
        print(<span class="hljs-string">'Running decorator'</span>)
        <span class="hljs-keyword">return</span> fun(*args, **kw)
    <span class="hljs-keyword">return</span> prt
<span class="hljs-meta">@decorator</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun</span>():</span>
    print(<span class="hljs-string">'Running function'</span>)
fun()</code></pre>
<p>Output:</p>
<pre><code class="python">Running decorator
Running function</code></pre>
<p><code>decorator()</code>関数を定義します。この関数は、パラメータを受け取ったときにfun関数を返す前にテキスト行を出力します。<code>decorator()</code>関数でデコレートしたいfun関数の前に@記号を追加すると、コンパイラがこの関数を自動的にデコレータに置き換えます。</p>
<p><code>fun = decorator(fun)</code>と同じです。</p>
<p>パラメータをデコレータに渡す必要がある場合は、デコレータを返す高次関数を作成する必要があります。</p>
<pre><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span>(<span class="hljs-params">text</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rtfun</span>(<span class="hljs-params">fun</span>):</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prt</span>(<span class="hljs-params">*args, **kw</span>):</span>
            print(<span class="hljs-string">'Running decorator'</span> + <span class="hljs-string">' and add '</span> + text)
            <span class="hljs-keyword">return</span> fun(*args, **kw)
        <span class="hljs-keyword">return</span> prt
    <span class="hljs-keyword">return</span> rtfun
<span class="hljs-meta">@decorator(<span class="hljs-params"><span class="hljs-string">'text'</span></span>)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun</span>():</span>
    print(<span class="hljs-string">'Running function'</span>)
fun()</code></pre>
<p>Output:</p>
<pre><code class="python">Running decorator and add text
Running function</code></pre>
</body></html>